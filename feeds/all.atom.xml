<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Darius Hall</title><link href="https://dariushall.com/" rel="alternate"></link><link href="https://dariushall.com/feeds/all.atom.xml" rel="self"></link><id>https://dariushall.com/</id><updated>2021-03-26T07:28:36-06:00</updated><subtitle>My piece of the Internet</subtitle><entry><title>Setting Up GitHub Pages With Pelican</title><link href="https://dariushall.com/setting-up-github-pages-with-pelican.html" rel="alternate"></link><published>2021-03-26T07:28:36-06:00</published><updated>2021-03-26T07:28:36-06:00</updated><author><name>Darius</name></author><id>tag:dariushall.com,2021-03-26:/setting-up-github-pages-with-pelican.html</id><summary type="html">&lt;p&gt;Over the last few days I have been trying to figure out how I want to go about chronicling my... accomplishments? I figured, if I'm going to spend time learning something, I should also invest some time documenting what I have learned for three reasons (in no particular order):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;So …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Over the last few days I have been trying to figure out how I want to go about chronicling my... accomplishments? I figured, if I'm going to spend time learning something, I should also invest some time documenting what I have learned for three reasons (in no particular order):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;So that I don't have to find all the sources out there on the web that lead to success all over again&lt;/li&gt;
&lt;li&gt;With the hopes that it proves useful to someone out there in comming days&lt;/li&gt;
&lt;li&gt;The stuff I've worked on stays in my head as a result of "writing it down" so to speak&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Setting up this site with GitHub Pages using Pelican (the Python based static site generator) was enough of a challenge that it seems like a fantastic place to start writing. So, let's get started!&lt;/p&gt;
&lt;p&gt;&lt;img alt="pelican" src="https://dariushall.com/images/birger-strahl-3FDMW9XoNXU-unsplash.jpg"&gt;
Photo by &lt;a href="https://unsplash.com/@bist31?utm_source=unsplash&amp;amp;utm_medium=referral&amp;amp;utm_content=creditCopyText" title="Birger Strahl"&gt;Birger Strahl&lt;/a&gt; on &lt;a href="https://unsplash.com/s/photos/pelican?utm_source=unsplash&amp;amp;utm_medium=referral&amp;amp;utm_content=creditCopyText" title="Unsplash"&gt;Unsplash&lt;/a&gt;  &lt;/p&gt;
&lt;hr&gt;
&lt;h1&gt;&lt;a id="resources"&gt;&lt;/a&gt;Resources I Used&lt;/h1&gt;
&lt;p&gt;I followed two guides to get this to work:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://fedoramagazine.org/make-github-pages-blog-with-pelican/"&gt;Fedora Magazine&lt;/a&gt; has a pretty solid write up that helped the most in figuring things out&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.tomordonez.com/make-static-website-python-github-pages/"&gt;Tom Ordonez's&lt;/a&gt; blog is where I found the Fedora Magazine reference and the idea to configure the GitHub Pages site with Cloudflare as CDN&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Setting Up GitHub&lt;/h1&gt;
&lt;p&gt;If you're not familiar with GitHub Pages, you can &lt;a href="https://pages.github.com/" title="GitHub Pages"&gt;read more about it here&lt;/a&gt;. In a nutshell, GitHub very generously offers to host "static" web content for you and/or your projects. No infrastructure to worry about. Extremely minimal configuration. The power of git workflow. A common use case for this is publishing personal/project blogs, for which, GitHub integrates with the Ruby based static site generator &lt;a href="https://jekyllrb.com/" title="Jekyll Static Site Generator"&gt;Jekyl&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;While I'm sure Jekyll is great, I'm a Python guy and decided to make the GitHub Pages (GHP) thing a tiny bit more complicated by using a Python based static site generator called &lt;a href="https://blog.getpelican.com/" title="Pelican Python Static Site Generator"&gt;Pelican&lt;/a&gt;. While GHP is capabile of automatically building the static files (HTML, etc.) when using Jekyll, choosing to use Pelican appears to mean doing things more manually (I say appears because I haven't actually looked further in to automating builds with anything else). To accomodate this manual process, two GitHub repos are suggested.&lt;/p&gt;
&lt;h2&gt;Creating the Repos&lt;/h2&gt;
&lt;p&gt;The &lt;a href="#resources"&gt;Fedora Magazine&lt;/a&gt; write up I followed suggests creating one GitHub repo named the way GHP requires, which is in the form &lt;code&gt;username.github.io&lt;/code&gt; (follow the &lt;a href="https://docs.github.com/en/github/working-with-github-pages/creating-a-github-pages-site" title="GitHub Pages Docs"&gt;official GHP docs&lt;/a&gt; if you are unsure how to do this). This is where the output files from Pelican will go. The name of the repo &lt;strong&gt;must exactly match&lt;/strong&gt; &lt;code&gt;username.github.io&lt;/code&gt; -- if it does not, GHP will not work. Make sure to initialize the repo with a readme. I left mine as a public repo. This repo will be configured as a submodle within the second repo at a later stage.&lt;/p&gt;
&lt;p&gt;I suppose the second repo name doesn't matter too much, but it is suggested to name it &lt;code&gt;username.github.io-src&lt;/code&gt;. This repo will contain the source files used to generate the HTML, CSS, etc. I set mine up with a &lt;code&gt;.gitignore&lt;/code&gt; for Python to make sure I'm not commiting unnecessary Python specific config to the repo.&lt;/p&gt;
&lt;h2&gt;Cloning the Repos&lt;/h2&gt;
&lt;p&gt;Once you have the repos created, they can be cloned to your local machine, but &lt;strong&gt;STOP&lt;/strong&gt;: if you are familiar with &lt;code&gt;git clone&lt;/code&gt;. Don't clone them both just yet. The &lt;code&gt;username.github.io&lt;/code&gt; repo will be set up as a submodule within &lt;code&gt;username.github.io-src&lt;/code&gt;. So, follow this sequence to make sure it's done right:&lt;/p&gt;
&lt;p&gt;This assumes you are set up in GitHub to &lt;a href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh" title="Using GitHub with SSH"&gt;clone via SSH&lt;/a&gt;. Make sure to replace &lt;code&gt;&amp;lt;your_username&amp;gt;&lt;/code&gt; and to execute this command where you want the cloned repo to exist locally. It will create a new directory called &lt;code&gt;ghpages&lt;/code&gt; in your current working directory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git clone git@github.com:&amp;lt;your_username&amp;gt;/&amp;lt;your_username&amp;gt;.github.io-src ghpages
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next, change to the &lt;code&gt;ghpages&lt;/code&gt; directory&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ghpages
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now you can set up the submodule. I'll be honest here, I'm not sure if this is the best way to do this or not, I was just following directions. But the ghp-import method the &lt;a href="https://docs.getpelican.com/en/latest/tips.html#publishing-to-github" title="Pelican Docs"&gt;Pelican docs&lt;/a&gt; talked about confused me and the Fedora Mag post seemed to confirm it didn't work as expected, so, I went with the "ask no questions" approach and blindly followed Fedora Mag. If you're interested, &lt;a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" title="Git Submodules"&gt;read more about submodules here&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git submodule add git@github.com:username/username.github.io.git output
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Your folder structure will look something like this at this point&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ghpages/
&lt;span class="p"&gt;|&lt;/span&gt;-- output/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Setting Up Python and Pelican&lt;/h1&gt;
&lt;p&gt;As mentioned previously, Pelican is a Python static site generator. As such, it is probably wise to use a virtual environment when installing and configuring Pelican so as not to interfere with your "global" Python environment. Personally, I am a huge fan of &lt;a href="https://github.com/pyenv/pyenv" title="GitHub Pyenv Page"&gt;pyenv&lt;/a&gt; for managing multiple versions of Python. When using the &lt;a href="https://github.com/pyenv/pyenv-installer" title="GitHub pyenv-installer Page"&gt;pyenv-installer&lt;/a&gt; script, you will also have access to &lt;a href="https://github.com/pyenv/pyenv-virtualenv" title="GitHub pyenv-virtualenv Page"&gt;pyenv-virtualenv&lt;/a&gt;. The combination of these tools is what I use to configure my Python development environments.&lt;/p&gt;
&lt;p&gt;Having said all that, I'll assume you're just using your system Python for these purposes.&lt;/p&gt;
&lt;h2&gt;Creating the Python Virtual Environment&lt;/h2&gt;
&lt;p&gt;Creating a Python virtual environment is pretty simple. Making sure to be in the &lt;code&gt;ghpages&lt;/code&gt; directory, run the following command (I'm putting python3 here. While Python 2 is EOL, many OSes have not completely migrated to Python 3 yet. In many cases, running &lt;code&gt;python --version&lt;/code&gt; in your terminal will show some version of Python 2 as the system python. I think it's safe to assume that running &lt;code&gt;python3&lt;/code&gt; will ensure you're using Python 3 even if your system's default Python version is 3.x):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3 -m venv .venv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With the virtual environment created, it's time  to activate it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;source&lt;/span&gt; ./.venv/bin/activate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The venv can be exited using:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;deactivate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Installing Pelican&lt;/h2&gt;
&lt;p&gt;Now that you have the virtual environment configured and active, you can install Pelican and it's dependancies without it affecting your system Python environment.&lt;/p&gt;
&lt;p&gt;Installing Pelican is as easy as:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip3 install pelican
pip3 install Markdown
pip3 install typogrify
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Initializing Pelican&lt;/h2&gt;
&lt;p&gt;With Pelican installed, getting the base configuration up and running is pretty easy. Again, making sure to be in &lt;code&gt;ghpages&lt;/code&gt;, run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pelican-quickstart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Pelican will present a series of questions to help in setting up the base configuration. Most of the options have defaults which are acceptable for this. Defaults will be expressed either in square regulare braces/parentheses &lt;code&gt;[ ]&lt;/code&gt; or &lt;code&gt;( )&lt;/code&gt;. Answer them as follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Welcome to pelican-quickstart v4.5.4.

This script will &lt;span class="nb"&gt;help&lt;/span&gt; you create a new Pelican-based website.

Please answer the following questions so this script can generate the files
needed by Pelican.

Where &lt;span class="k"&gt;do&lt;/span&gt; you want to create your new web site? &lt;span class="o"&gt;[&lt;/span&gt;.&lt;span class="o"&gt;]&lt;/span&gt;
What will be the title of this web site? &amp;lt;provide your desired title&amp;gt;
Who will be the author of this web site? &amp;lt;your name&amp;gt;
What will be the default language of this web site? &lt;span class="o"&gt;[&lt;/span&gt;en&lt;span class="o"&gt;]&lt;/span&gt;
Do you want to specify a URL prefix? e.g., https://example.com   &lt;span class="o"&gt;(&lt;/span&gt;Y/n&lt;span class="o"&gt;)&lt;/span&gt;
What is your URL prefix? &lt;span class="o"&gt;(&lt;/span&gt;see above example&lt;span class="p"&gt;;&lt;/span&gt; no trailing slash&lt;span class="o"&gt;)&lt;/span&gt; https://username.github.io &amp;lt;or customer domain, in my &lt;span class="k"&gt;case&lt;/span&gt; https://dariushall.com&amp;gt;
Do you want to &lt;span class="nb"&gt;enable&lt;/span&gt; article pagination? &lt;span class="o"&gt;(&lt;/span&gt;Y/n&lt;span class="o"&gt;)&lt;/span&gt;
What is your &lt;span class="nb"&gt;time&lt;/span&gt; zone? &lt;span class="o"&gt;[&lt;/span&gt;Europe/Paris&lt;span class="o"&gt;]&lt;/span&gt; &amp;lt;use a tz database compatible name&amp;gt;
Do you want to generate a tasks.py/Makefile to automate generation and publishing? &lt;span class="o"&gt;(&lt;/span&gt;Y/n&lt;span class="o"&gt;)&lt;/span&gt;
Do you want to upload your website using FTP? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt;
Do you want to upload your website using SSH? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt;
Do you want to upload your website using Dropbox? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt;
Do you want to upload your website using S3? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt;
Do you want to upload your website using Rackspace Cloud Files? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt;
Do you want to upload your website using GitHub Pages? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt; Y &amp;lt;&lt;span class="nb"&gt;set&lt;/span&gt; this to Y&amp;gt;
Is this your personal page &lt;span class="o"&gt;(&lt;/span&gt;username.github.io&lt;span class="o"&gt;)&lt;/span&gt;? &lt;span class="o"&gt;(&lt;/span&gt;y/N&lt;span class="o"&gt;)&lt;/span&gt; Y &amp;lt;&lt;span class="nb"&gt;set&lt;/span&gt; this to Y&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The options you'll need to change from default are the &lt;code&gt;Do you want to upload your website using GitHub Pages?&lt;/code&gt; and &lt;code&gt;Is this your personal page (username.github.io)?&lt;/code&gt; Make sure to change those to &lt;code&gt;Y&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Configuring Pelican&lt;/h2&gt;
&lt;p&gt;Having completed the &lt;code&gt;pelican-quickstart&lt;/code&gt;, you'll have a pretty good initial baseline to build up from. Most of the initial "building up" is done in the pelican configuration files &lt;code&gt;pelicanconf.py&lt;/code&gt; and &lt;code&gt;publishconf.py&lt;/code&gt;. Some additional configuration will be done through updating the default directory structure as well.&lt;/p&gt;
&lt;h3&gt;&lt;a id="config-files"&gt;&lt;/a&gt;Config Files&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pelicanconf.py&lt;/code&gt; is the configuration file Pelican uses when building/publishing and running things locally. The settings defined here are also imported in to the &lt;code&gt;publishconf.py&lt;/code&gt; file, so it's a good place to configure as many settings as possible that aren't dependant on the final published "product".&lt;/li&gt;
&lt;li&gt;&lt;code&gt;publishconf.py&lt;/code&gt;, as mentioned above, imports the &lt;code&gt;pelicanconf.py&lt;/code&gt; configurations and allows you to overide anything that needs to be changed for the live version of the site. And example would be the &lt;code&gt;SITEURL&lt;/code&gt; setting, which you'll defenitely want different between to two files - don't worry, the quickstart will have taken care of that one for you!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Open &lt;code&gt;publishconf.py&lt;/code&gt; and add the following line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;DELETE_OUTPUT_DIRECTORY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This is very important - when the publish command is issued, Pelican will try clean up after itself by default. But with the way we have things set up, that would eliminate our submodule and make life difficult every time we publish.&lt;/p&gt;
&lt;p&gt;At this point, you probably don't need to mess around with &lt;code&gt;pelicanconf.py&lt;/code&gt; too much. Most of the defaults will work for the purposes of this writeup. The Pelican docs have tons of information about &lt;a href="https://docs.getpelican.com/en/latest/settings.html" title="Pelican Settings"&gt;available settings&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are a few addtions that we'll make here though. Add the following lines to &lt;code&gt;pelicanconf.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;STATIC_PATHS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;extra/CNAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;EXTRA_PATH_METADATA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;extra/CNAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;path&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;CNAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;},}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The above lines will set things up to help Pelican find the images directory and get things ready to use a custom domain name. &lt;strong&gt;NOTE:&lt;/strong&gt; If you are not planning to use a custom domain, I believe the CNAME entries are unnecessary.&lt;/p&gt;
&lt;p&gt;The next setting I use to avoid publishing an incomplete article prematurely is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;DEFAULT_METADATA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;status&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draft&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This will place generated pages for an article in &lt;code&gt;SITEURL/drafts/article_name.html&lt;/code&gt;. Once a post is complete, the &lt;code&gt;Status: published&lt;/code&gt; page "front matter" or page meta will tell Pelican it's ready to go live. &lt;/p&gt;
&lt;h3&gt;Test Post&lt;/h3&gt;
&lt;p&gt;At this point, it seems like it's time for a first post test. Create a new file in the &lt;code&gt;content&lt;/code&gt; directory called &lt;code&gt;first-post.md&lt;/code&gt;. Yes, Pelican uses Markdown (or reStructured Text) for page authoring. For a reference, see &lt;a href="https://www.markdownguide.org/basic-syntax" title="Markdown Reference"&gt;markdownguide.org&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Title&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;First&lt;/span&gt; &lt;span class="n"&gt;Post&lt;/span&gt;
&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;
&lt;span class="n"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Other&lt;/span&gt;
&lt;span class="n"&gt;Tags&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;tag1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tag2&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tag3&lt;/span&gt;
&lt;span class="n"&gt;Slug&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;
&lt;span class="n"&gt;Author&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Your&lt;/span&gt; &lt;span class="n"&gt;Name&lt;/span&gt;
&lt;span class="n"&gt;Summary&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Summary&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;

&lt;span class="n"&gt;Start&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Lorem&lt;/span&gt; &lt;span class="n"&gt;Ipsum&lt;/span&gt;
&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There are ways to avoid using some (or even any of) the meta data. Take a look at Pelican docs for details.&lt;/p&gt;
&lt;p&gt;With the page written up, it can be test published by using the commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;make html &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make devserver
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you system is not set up for &lt;code&gt;make&lt;/code&gt;, you can also run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;pelican&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="n"&gt;pelicanconf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;
&lt;span class="n"&gt;pelican&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;ignore&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Either way you choose to generate the local instance, it will start up a local webserver listening at &lt;code&gt;localhost:8000&lt;/code&gt;. Navigate there with your favorite browser. If I have guided you correctly up to this point, you should have a functioning dev instance of you new site. If things are broken, well... I'm sorry. But you favorite search engine is your friend :D.&lt;/p&gt;
&lt;h2&gt;&lt;a id="publishing"&gt;&lt;/a&gt;Publishing to GitHub&lt;/h2&gt;
&lt;p&gt;Once you are satisfied with you post, we'll need to move from draft to publish, then publish and push all those changes to GitHub. Make sure to add the meta &lt;code&gt;Status: published&lt;/code&gt; to the post.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;Title&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;First&lt;/span&gt; &lt;span class="n"&gt;Post&lt;/span&gt;
&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;
&lt;span class="n"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Other&lt;/span&gt;
&lt;span class="n"&gt;Tags&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;tag1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tag2&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tag3&lt;/span&gt;
&lt;span class="n"&gt;Slug&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;first&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;
&lt;span class="n"&gt;Author&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Your&lt;/span&gt; &lt;span class="n"&gt;Name&lt;/span&gt;
&lt;span class="n"&gt;Summary&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Summary&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Status&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;published&lt;/span&gt;

&lt;span class="n"&gt;Start&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;first&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Lorem&lt;/span&gt; &lt;span class="n"&gt;Ipsum&lt;/span&gt;
&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next, publish the page using &lt;code&gt;make&lt;/code&gt; or the &lt;code&gt;pelican&lt;/code&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;make publish
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Or&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pelican content -o output -s publishconf.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then go through the &lt;code&gt;git&lt;/code&gt; workflow. This is all assuming you are in the root of the &lt;code&gt;ghpages/&lt;/code&gt; directory, as with all the other commands in this article. You will need to follow the git flow twice, first in the &lt;code&gt;output/&lt;/code&gt; directory or submodule, then in the &lt;code&gt;ghpages&lt;/code&gt; root directory.&lt;/p&gt;
&lt;p&gt;Before running the git workflow, add &lt;code&gt;*.pyc&lt;/code&gt; to your &lt;code&gt;.gitignore&lt;/code&gt; file&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; output
git add .
git commit -m &lt;span class="s1"&gt;&amp;#39;commit message&amp;#39;&lt;/span&gt;
git push

&lt;span class="nb"&gt;cd&lt;/span&gt; ..
git add .
git commit -m &lt;span class="s1"&gt;&amp;#39;commit message&amp;#39;&lt;/span&gt;
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Within a few moments, you should be able to visit https://username.github.io with your site live. Now for setting up the custom domain.&lt;/p&gt;
&lt;h1&gt;Setting Up a Custom Domain&lt;/h1&gt;
&lt;p&gt;I'm not going to go over setting up DNS with your domain registrar. That really depends on who your registrar is and there are far too many of those. The &lt;a href="https://docs.github.com/en/github/working-with-github-pages/configuring-a-custom-domain-for-your-github-pages-site" title="GitHub Pages Custom Domains"&gt;GitHub Pages docs&lt;/a&gt; have some guidance here. The GHP docs cover the GitHub config, but I'll mention it here briefly too.&lt;/p&gt;
&lt;p&gt;Go to the &lt;code&gt;username.github.io&lt;/code&gt; repo &amp;gt; settings &amp;gt; GitHub Pages section. Add your registered domain name in the field and hit save. GHP supports several types of domain: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;www.domain.com&lt;/li&gt;
&lt;li&gt;custom subdomain (like blog.domain.com)&lt;/li&gt;
&lt;li&gt;apex domain like domain.com&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What you provide to GHP will be dependant on how you have set up your DNS records. Whatever it is you choose, it will need to match what we apply to a new file that needs to be created in &lt;code&gt;extra/&lt;/code&gt;. In an &lt;a href="#config-files"&gt;earlier configuration&lt;/a&gt; step for Pelican, we applied a the &lt;code&gt;STATIC_PATHS&lt;/code&gt; AND &lt;code&gt;EXTRA_PATH_METADATA&lt;/code&gt; settings, referencing a file called &lt;code&gt;CNAME&lt;/code&gt;. Create this file now, with no file extention in the &lt;code&gt;extra/&lt;/code&gt; directory. Edit the new file by adding the same domain configuration you applied to the GHP setting for your repo. There should be no &lt;code&gt;http(s)://&lt;/code&gt; or trailing slash on what you put here. So in my case, with using the apex domain, it was simply&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;dariushall.com&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once this is complete, &lt;a href="#publishing"&gt;republish you site&lt;/a&gt;. Within a few moments, the site should be alive and well. At this point, you should also be able to check the &lt;code&gt;Enforce HTTPS&lt;/code&gt; setting within the GHP settings on the repo. This will have GitHub force a redirect from http requests to https.&lt;/p&gt;
&lt;h1&gt;Setting up Cloudflare&lt;/h1&gt;
&lt;p&gt;To improve the user experience and protect you website from some level of abuse, I would encourage you to take advantage of Cloudflare's really generous &lt;a href="https://www.cloudflare.com/plans/" title="Cloudflare Pricing Page"&gt;free/personal website tier&lt;/a&gt;. In order to do so, sign up for a free account, add your website and follow the instructions. I think they were quite clear and easy to use. Cloudflare basically does all the work for you by importing DNS settings from your registrar and walking you through how to change the default nameservers to Cloudflare's nameservers.&lt;/p&gt;
&lt;p&gt;Cloudflare will then start acting as a Content Deliver Network for your website. A CDN will cache static assets from your website (HTML, JS, CSS, Images, etc.) by requesting them from your website (or origin as they like to call it). Once the CDN has those files, it distributes them to hundreds of CDN servers around the world. Next time a visitor to your site requests an asset cached by the CDN, they will be able to receive that asset from their closest CDN server, dramatically increasing the response time for them, even if they are on the oposite side of the word to your origin server. Check out &lt;a href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn/" title="What is a CDN"&gt;Cloudflare's explanation&lt;/a&gt; if you want more details.&lt;/p&gt;
&lt;h1&gt;Wrapping Up&lt;/h1&gt;
&lt;p&gt;So, that's it. If all goes well, and I haven't provided a completely garbage set of instructions here, you should have a shiny new website/blog up and running that performs extremely well, and that can withstand up to 59Tbps DDoS attacks, for the cost of just your domain name registration (and maybe a few grey hairs trying to troubleshoot issues). Feel free to take a look at my &lt;a href="https://github.com/dubiZA/dubiza.github.io-src" title="Pelican Source Repo"&gt;source repo&lt;/a&gt;&lt;/p&gt;</content><category term="Other"></category><category term="python"></category><category term="pelican"></category><category term="github"></category><category term="reference"></category></entry><entry><title>Configuring the AWS CLI</title><link href="https://dariushall.com/configuring-the-aws-cli.html" rel="alternate"></link><published>2021-03-23T07:49:30-06:00</published><updated>2021-03-23T07:49:30-06:00</updated><author><name>Darius</name></author><id>tag:dariushall.com,2021-03-23:/configuring-the-aws-cli.html</id><summary type="html">&lt;p&gt;Every time I set up a fresh install of an operating system as a result of a new computer or messing around with different OSes on existing systems, I end up having to set up the AWS CLI from scratch. I have multiple personal AWS accounts to use for learning …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Every time I set up a fresh install of an operating system as a result of a new computer or messing around with different OSes on existing systems, I end up having to set up the AWS CLI from scratch. I have multiple personal AWS accounts to use for learning and running services that I want on a more resilient platform than running them on a server at home. It's always a pain to find the right doc pages for setting up the CLI with easy MFA assume role, so it's time to document that here.&lt;/p&gt;
&lt;h1&gt;Setting Up the AWS Credentials File&lt;/h1&gt;
&lt;p&gt;The first step is configuring the &lt;code&gt;~/.aws/credentials&lt;/code&gt; file. AWS calls this the 'shared credentials file'. The way I use my accounts, I have set up an AWS Organizations organization. The organization master account is the 'front-door' to my other accounts through a 'master role' that can be assumed in all other accounts (including the org master account). I then have a single IAM user in the org master account which has limited IAM permissions, but which can assume the org master role in my several accounts. As such, the only stanza I have in my shared credentials file is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;default&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;aws_access_key_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; AKIAMYACCESSKEY
&lt;span class="nv"&gt;aws_secret_access_key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; mySeCREtacc3SSk3y+aws
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The above stanza is then used for any CLI call made without specifying a CLI profile. As mentioned earlier, the IAM user to which this credential belongs can't do a whole heck of a lot, so some additional configuration is made in the &lt;code&gt;~/.aws/config&lt;/code&gt; file. This file has several more stanzas in it, one of each account in which I want to be able to assume the master role. While I may not be following best practices here for IAM access, being a one man show with only personal accounts and no production sensitive activity going on, this setup suits my needs for now.&lt;/p&gt;
&lt;h1&gt;Setting Up the AWS Config File&lt;/h1&gt;
&lt;p&gt;The AWS Configuration file provides a means for defining profiles which I can then use with the &lt;code&gt;--profile&lt;/code&gt; flag when making CLI calls. This file provides a means for defining which role should be used and where to look for the MFA device when needing to issue a command to a specific account. I have MFA required for all assumed role calls using the org master role I have set up. The config file looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;default&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;region&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; us-east-1
&lt;span class="nv"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; yaml

&lt;span class="o"&gt;[&lt;/span&gt;profile org-master&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;region&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; us-east-1
&lt;span class="nv"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; yaml
&lt;span class="nv"&gt;role_arn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; arn:aws:iam::210987654321:role/role_to_assume
&lt;span class="nv"&gt;mfa_serial&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; arn:aws:iam::210987654321:mfa/iam_user_name
&lt;span class="nv"&gt;source_profile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; default

&lt;span class="o"&gt;[&lt;/span&gt;profile learning&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;region&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; us-east-1
&lt;span class="nv"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; yaml
&lt;span class="nv"&gt;role_arn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; arn:aws:iam::123456789012:role/role_to_assume
&lt;span class="nv"&gt;mfa_serial&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; arn:aws:iam::210987654321:mfa/iam_user_name
&lt;span class="nv"&gt;source_profile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; default
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The first stanza is a reference to the default "profile" and credentials set up in the shared credentials file. The second and third stanzas are named profiles, &lt;code&gt;org-master&lt;/code&gt; and &lt;code&gt;larning&lt;/code&gt; in this case, which tells the CLI how to access and assume the role required to use the profile. The important bits are &lt;code&gt;role_arn&lt;/code&gt;, &lt;code&gt;mfa_serial&lt;/code&gt; and &lt;code&gt;source_profile&lt;/code&gt;. &lt;code&gt;role_arn&lt;/code&gt; should be for the role in the account which you want to jump in to. The &lt;code&gt;mfa_serial&lt;/code&gt; tells the CLI in which account the MFA device is configured and this should match the account specified in the &lt;code&gt;source_profile&lt;/code&gt; section.&lt;/p&gt;
&lt;p&gt;You will notice in the &lt;code&gt;org-master&lt;/code&gt; profile, that the AWS account ID in the role ARN and MFA device ARN are the same. In this case, it's because I want to assume the priviledged role in the same account as the IAM user assuming the role.&lt;/p&gt;
&lt;p&gt;In the &lt;code&gt;learning&lt;/code&gt; profile, the account ID in the role ARN and MFA device ARN are different. This is because the IAM user defined in the &lt;code&gt;source_profile&lt;/code&gt; (the default profile configured with the access key and secret access key for my IAM user) is to assume the role in the account with the ID specified in the &lt;code&gt;role_arn&lt;/code&gt;. This all probably sounds terribly confusing. But once it's configured and you've issued &lt;code&gt;aws sts get-caller-identity&lt;/code&gt; a few times, with and without the &lt;code&gt;--profile&lt;/code&gt; flag, you will see how this all works.&lt;/p&gt;
&lt;h1&gt;Scaling Things Up&lt;/h1&gt;
&lt;p&gt;On my work laptop, my &lt;code&gt;~/.aws/config&lt;/code&gt; and &lt;code&gt;~/.aws/credentials&lt;/code&gt; files look a little different. In the shared credentials file, I have a couple of different profiles configured, beyond just the 'default'. The shared credentials file is largely the same, but with several stanzas for each IAM user with their own access key and secret access key's defined.&lt;/p&gt;
&lt;p&gt;The configuration file changes a bit in this case if the IAM users are authorized to assume different roles in different accounts. The only things that really change though in the named profiles are the &lt;code&gt;mfa_serial&lt;/code&gt; and &lt;code&gt;source_profile&lt;/code&gt;. Instead of each named profile having the same configuration for tese two settings, they would be changed depending on the IAM user required to assume the roles in the various accounts.&lt;/p&gt;
&lt;h1&gt;Wrapping Up&lt;/h1&gt;
&lt;p&gt;Hopefully this makes sense to you, the reader. Mostly this is meant to be a quick write up so that I have it available to me next time I need to set this up.&lt;/p&gt;
&lt;p&gt;For what it's worth, here are a handful of links that might come in useful:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html"&gt;AWS CLI docs on AWS's docs site&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/topic/config-vars.html"&gt;AWS CLI Command Line Reference config variables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="AWS"></category><category term="aws"></category><category term="cli"></category><category term="awscli"></category><category term="reference"></category></entry></feed>